# V4.1 Popup Implementation Guide

## ‚úÖ Completed

### 1. Core Infrastructure
- **PopupModal Component**: Reusable modal with 75% viewport max size
- **Popup State Management**: Added activePopup state to V4 page
- **Escape Key Support**: Close popups with Esc key
- **Click Outside to Close**: Tap backdrop to dismiss

### 2. Profile Card Popups (All 4 Directions)
- **Up - Edit Profile**: Full form with avatar upload, save to Supabase
- **Down - Analytics**: Stats dashboard with charts and metrics
- **Left - Browse Users**: User carousel with navigation
- **Right - Share Profile**: Share options with QR code

### 3. AI Assistant Card Popups (All 4 Directions)
- **Up - New Conversation**: Full chat interface with typing indicator
- **Down - History**: Searchable conversation history
- **Left - AI Settings**: Model selection, temperature, features
- **Right - Quick Ask**: Pre-defined prompt templates

## üöß Remaining Popup Components

### 3. Business Card Popups
Create `src/components/cards/BusinessIdCard/BusinessPopups.tsx`:

#### Up - Call Contact
- Click-to-call interface
- Recent call history
- Call notes section
- Schedule callback

#### Down - Send Email
- Email composer with rich text editor
- Email templates
- Attachment support
- Send history

#### Left - View Details
- Full company profile
- Contact information
- Location map
- Business hours

#### Right - Add to CRM
- CRM integration form
- Lead scoring
- Tags and categories
- Follow-up reminders

### 4. Settings Card Popups
Create `src/components/cards/SettingsCard/SettingsPopups.tsx`:

#### Up - Backup Settings
- Backup options (local/cloud)
- Backup history
- Restore points
- Auto-backup schedule

#### Down - Reset to Default
- Confirmation dialog
- Selective reset options
- Backup before reset
- Reset history

#### Left - Import Config
- File upload interface
- Config validation
- Preview changes
- Import history

#### Right - Export Config
- Export format selection
- Include/exclude options
- Download manager
- Export templates

### 5. Supabase Card Popups
Create `src/components/cards/SupabaseCard/SupabasePopups.tsx`:

#### Up - Query Database
- SQL query editor with syntax highlighting
- Query history
- Saved queries
- Results table with export

#### Down - Manage Tables
- Table list with schema viewer
- Create/edit table interface
- Indexes and constraints
- Data browser

#### Left - Security Settings
- RLS policies editor
- User permissions
- API keys management
- Audit logs

#### Right - API Access
- REST API documentation
- GraphQL playground
- API key generation
- Rate limiting settings

## üìù Implementation Pattern

For each remaining card, follow this pattern:

```typescript
// BusinessPopups.tsx example
export const BusinessCallPopup: React.FC<{ theme: Theme }> = ({ theme }) => {
  const isDark = theme === 'dark';
  
  return (
    <div className="space-y-6">
      {/* Main content area */}
      {/* Interactive elements */}
      {/* Action buttons */}
    </div>
  );
};
```

Then update the V4 page:

1. Import the popup components
2. Update the action handlers to use setActivePopup
3. Add PopupModal instances for each direction

## üîß Integration Steps

1. **Update Business Actions** in V4 page:
```typescript
const businessActions: SwipeAction[] = [
  {
    direction: 'up',
    label: 'Call Contact',
    icon: <Phone size={20} />,
    color: 'bg-green-500',
    action: async () => {
      setActivePopup({ isOpen: true, direction: 'up', cardType: 'business_id' });
    }
  },
  // ... other directions
];
```

2. **Add Popup Modals** to V4 page:
```typescript
{activePopup.cardType === 'business_id' && (
  <>
    <PopupModal
      isOpen={activePopup.isOpen && activePopup.direction === 'up'}
      onClose={() => setActivePopup({ isOpen: false, direction: null, cardType: null })}
      title="Call Contact"
      theme={theme}
    >
      <BusinessCallPopup theme={theme} />
    </PopupModal>
    {/* ... other directions */}
  </>
)}
```

## üé® Design Guidelines

- **Consistent Layout**: All popups use the same spacing and grid system
- **Dark/Light Theme**: Support both themes with isDark checks
- **Responsive Design**: Works on mobile and desktop
- **Scrollable Content**: Long content scrolls within the 75% viewport
- **Interactive Elements**: Forms, buttons, and inputs are fully functional
- **Loading States**: Show spinners for async operations
- **Error Handling**: Display user-friendly error messages

## üîó Supabase Integration

All popups should integrate with Supabase where appropriate:
- Save form data using supabaseMCP
- Fetch data for displays
- Update records on user actions
- Handle errors gracefully

## ‚ú® Features Maintained

- **Original V3 Cards**: All card designs remain unchanged
- **Swipe Detection**: 25% confirmation, 50% execution
- **Double-Tap Flip**: Still functional on cards
- **Scroll Prevention**: When popup is open
- **Keyboard Navigation**: Arrow keys for card switching 